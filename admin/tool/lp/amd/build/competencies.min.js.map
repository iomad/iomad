{"version":3,"sources":["../src/competencies.js"],"names":["define","$","notification","ajax","templates","str","Picker","dragdrop","Pending","competencies","itemid","itemtype","pagectxid","pageContextId","pickerInstance","prop","registerEvents","registerDragDrop","prototype","localthis","get_string","done","movestring","identifier","component","drag","drop","handleDrop","fail","exception","fromid","data","toid","requests","call","methodname","args","courseid","competencyidfrom","competencyidto","templateid","planid","pickCompetency","self","pagerender","pageregion","pageContextIncludes","on","e","compIds","competencyIds","pendingPromise","each","index","compId","push","competencyid","moduleid","pagecontext","contextid","length","then","context","render","html","js","replaceNode","resolve","catch","display","doDelete","deleteid","replaceWith","runTemplateJS","deleteHandler","message","id","competency","get_strings","key","param","shortname","strings","confirm","coursecompetencyid","target","ruleoutcome","val","click","preventDefault","closest"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle add/remove competency links.\n *\n * @module     tool_lp/competencies\n * @package    tool_lp\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/notification',\n        'core/ajax',\n        'core/templates',\n        'core/str',\n        'tool_lp/competencypicker',\n        'tool_lp/dragdrop-reorder',\n        'core/pending'],\n       function($, notification, ajax, templates, str, Picker, dragdrop, Pending) {\n\n    /**\n     * Constructor\n     *\n     * @param {Number} itemid\n     * @param {String} itemtype\n     * @param {Number} pagectxid\n     */\n    var competencies = function(itemid, itemtype, pagectxid) {\n        this.itemid = itemid;\n        this.itemtype = itemtype;\n        this.pageContextId = pagectxid;\n        this.pickerInstance = null;\n\n        $('[data-region=\"actions\"] button').prop('disabled', false);\n        this.registerEvents();\n        this.registerDragDrop();\n    };\n\n    /**\n     * Initialise the drag/drop code.\n     * @method registerDragDrop\n     */\n    competencies.prototype.registerDragDrop = function() {\n        var localthis = this;\n        // Init this module.\n        str.get_string('movecompetency', 'tool_lp').done(\n            function(movestring) {\n                dragdrop.dragdrop('movecompetency',\n                                  movestring,\n                                  {identifier: 'movecompetency', component: 'tool_lp'},\n                                  {identifier: 'movecompetencyafter', component: 'tool_lp'},\n                                  'drag-samenode',\n                                  'drag-parentnode',\n                                  'drag-handlecontainer',\n                                  function(drag, drop) {\n                                      localthis.handleDrop(drag, drop);\n                                  });\n            }\n        ).fail(notification.exception);\n\n    };\n\n    /**\n     * Handle a drop from a drag/drop operation.\n     *\n     * @method handleDrop\n     * @param {DOMNode} drag The dragged node.\n     * @param {DOMNode} drop The dropped on node.\n     */\n    competencies.prototype.handleDrop = function(drag, drop) {\n        var fromid = $(drag).data('id');\n        var toid = $(drop).data('id');\n        var localthis = this;\n        var requests = [];\n\n        if (localthis.itemtype == 'course') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_course_competency',\n                    args: {courseid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else if (localthis.itemtype == 'template') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_template_competency',\n                    args: {templateid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else if (localthis.itemtype == 'plan') {\n            requests = ajax.call([\n                {\n                    methodname: 'core_competency_reorder_plan_competency',\n                    args: {planid: localthis.itemid, competencyidfrom: fromid, competencyidto: toid}\n                }\n            ]);\n        } else {\n            return;\n        }\n\n        requests[0].fail(notification.exception);\n    };\n\n    /**\n     * Pick a competency\n     *\n     * @method pickCompetency\n     * @return {Promise}\n     */\n    competencies.prototype.pickCompetency = function() {\n        var self = this;\n        var requests;\n        var pagerender;\n        var pageregion;\n        var pageContextIncludes;\n\n        if (!self.pickerInstance) {\n            if (self.itemtype === 'template' || self.itemtype === 'course') {\n                pageContextIncludes = 'parents';\n            }\n            self.pickerInstance = new Picker(self.pageContextId, false, pageContextIncludes);\n            self.pickerInstance.on('save', function(e, data) {\n                var compIds = data.competencyIds;\n                var pendingPromise = new Pending();\n\n                if (self.itemtype === \"course\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_course',\n                            args: {courseid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                        methodname: 'tool_lp_data_for_course_competencies_page',\n                        args: {courseid: self.itemid, moduleid: 0}\n                    });\n\n                    pagerender = 'tool_lp/course_competencies_page';\n                    pageregion = 'coursecompetenciespage';\n\n                } else if (self.itemtype === \"template\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_template',\n                            args: {templateid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                        methodname: 'tool_lp_data_for_template_competencies_page',\n                        args: {templateid: self.itemid, pagecontext: {contextid: self.pageContextId}}\n                    });\n                    pagerender = 'tool_lp/template_competencies_page';\n                    pageregion = 'templatecompetenciespage';\n                } else if (self.itemtype === \"plan\") {\n                    requests = [];\n\n                    $.each(compIds, function(index, compId) {\n                        requests.push({\n                            methodname: 'core_competency_add_competency_to_plan',\n                            args: {planid: self.itemid, competencyid: compId}\n                        });\n                    });\n                    requests.push({\n                         methodname: 'tool_lp_data_for_plan_page',\n                         args: {planid: self.itemid}\n                    });\n                    pagerender = 'tool_lp/plan_page';\n                    pageregion = 'plan-page';\n                }\n                ajax.call(requests)[requests.length - 1]\n                .then(function(context) {\n                    return templates.render(pagerender, context);\n                })\n                .then(function(html, js) {\n                    templates.replaceNode($('[data-region=\"' + pageregion + '\"]'), html, js);\n                    return;\n                })\n                .then(pendingPromise.resolve)\n                .catch(notification.exception);\n            });\n        }\n\n        return self.pickerInstance.display();\n    };\n\n    /**\n     * Delete the link between competency and course, template or plan. Reload the page.\n     *\n     * @method doDelete\n     * @param {int} deleteid The id of record to delete.\n     */\n    competencies.prototype.doDelete = function(deleteid) {\n        var localthis = this;\n        var requests = [],\n            pagerender = '',\n            pageregion = '';\n\n        // Delete the link and reload the page template.\n        if (localthis.itemtype == 'course') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_course',\n                    args: {courseid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_course_competencies_page',\n                    args: {courseid: localthis.itemid, moduleid: 0}}\n            ]);\n            pagerender = 'tool_lp/course_competencies_page';\n            pageregion = 'coursecompetenciespage';\n        } else if (localthis.itemtype == 'template') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_template',\n                    args: {templateid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_template_competencies_page',\n                    args: {templateid: localthis.itemid, pagecontext: {contextid: localthis.pageContextId}}}\n            ]);\n            pagerender = 'tool_lp/template_competencies_page';\n            pageregion = 'templatecompetenciespage';\n        } else if (localthis.itemtype == 'plan') {\n            requests = ajax.call([\n                {methodname: 'core_competency_remove_competency_from_plan',\n                    args: {planid: localthis.itemid, competencyid: deleteid}},\n                {methodname: 'tool_lp_data_for_plan_page',\n                    args: {planid: localthis.itemid}}\n            ]);\n            pagerender = 'tool_lp/plan_page';\n            pageregion = 'plan-page';\n        }\n\n        requests[1].done(function(context) {\n            templates.render(pagerender, context).done(function(html, js) {\n                $('[data-region=\"' + pageregion + '\"]').replaceWith(html);\n                templates.runTemplateJS(js);\n            }).fail(notification.exception);\n        }).fail(notification.exception);\n\n    };\n\n    /**\n     * Show a confirm dialogue before deleting a competency.\n     *\n     * @method deleteHandler\n     * @param {int} deleteid The id of record to delete.\n     */\n    competencies.prototype.deleteHandler = function(deleteid) {\n        var localthis = this;\n        var requests = [];\n        var message;\n\n        if (localthis.itemtype == 'course') {\n            message = 'unlinkcompetencycourse';\n        } else if (localthis.itemtype == 'template') {\n            message = 'unlinkcompetencytemplate';\n        } else if (localthis.itemtype == 'plan') {\n            message = 'unlinkcompetencyplan';\n        } else {\n            return;\n        }\n\n        requests = ajax.call([{\n            methodname: 'core_competency_read_competency',\n            args: {id: deleteid}\n        }]);\n\n        requests[0].done(function(competency) {\n            str.get_strings([\n                {key: 'confirm', component: 'moodle'},\n                {key: message, component: 'tool_lp', param: competency.shortname},\n                {key: 'confirm', component: 'moodle'},\n                {key: 'cancel', component: 'moodle'}\n            ]).done(function(strings) {\n                notification.confirm(\n                    strings[0], // Confirm.\n                    strings[1], // Unlink the competency X from the course?\n                    strings[2], // Confirm.\n                    strings[3], // Cancel.\n                    function() {\n                        localthis.doDelete(deleteid);\n                    }\n                );\n            }).fail(notification.exception);\n        }).fail(notification.exception);\n    };\n\n    /**\n     * Register the javascript event handlers for this page.\n     *\n     * @method registerEvents\n     */\n    competencies.prototype.registerEvents = function() {\n        var localthis = this;\n\n        if (localthis.itemtype == 'course') {\n            // Course completion rule handling.\n            $('[data-region=\"coursecompetenciespage\"]').on('change', 'select[data-field=\"ruleoutcome\"]', function(e) {\n                var pendingPromise = new Pending();\n                var requests = [];\n                var pagerender = 'tool_lp/course_competencies_page';\n                var pageregion = 'coursecompetenciespage';\n                var coursecompetencyid = $(e.target).data('id');\n                var ruleoutcome = $(e.target).val();\n                requests = ajax.call([\n                    {methodname: 'core_competency_set_course_competency_ruleoutcome',\n                      args: {coursecompetencyid: coursecompetencyid, ruleoutcome: ruleoutcome}},\n                    {methodname: 'tool_lp_data_for_course_competencies_page',\n                      args: {courseid: localthis.itemid, moduleid: 0}}\n                ]);\n\n                requests[1].then(function(context) {\n                    return templates.render(pagerender, context);\n                })\n                .then(function(html, js) {\n                    return templates.replaceNode($('[data-region=\"' + pageregion + '\"]'), html, js);\n                })\n                .then(pendingPromise.resolve)\n                .catch(notification.exception);\n            });\n        }\n\n        $('[data-region=\"actions\"] button').click(function(e) {\n            var pendingPromise = new Pending();\n            e.preventDefault();\n\n            localthis.pickCompetency()\n                .then(pendingPromise.resolve)\n                .catch();\n        });\n        $('[data-action=\"delete-competency-link\"]').click(function(e) {\n            e.preventDefault();\n\n            var deleteid = $(e.target).closest('[data-id]').data('id');\n            localthis.deleteHandler(deleteid);\n        });\n    };\n\n    return /** @alias module:tool_lp/competencies */ competencies;\n});\n"],"file":"competencies.min.js"}