function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("core_message/message_drawer_view_conversation_patcher",["jquery","core/user_date","core_message/message_drawer_view_conversation_constants"],function(a,b,c){var d=function(a,c){var d=a.reduce(function(a,d){var e=d.timeCreated?d.timeCreated:c,f=b.getUserMidnightForTimestamp(e,c);if(a.hasOwnProperty(f)){a[f].push(d)}else{a[f]=[d]}return a},{});return Object.keys(d).map(function(a){return{timestamp:a,messages:d[a]}})},e=function(c,a,d){a=a.slice();var e=[],f=[],g=[];c.forEach(function(b){var c=!1,e=0;for(;e<a.length;e++){var h=a[e];if(d(b,h)){c=!0;g.push({a:b,b:h});break}}if(c){a.splice(e,1)}else{f.push(b)}});e=a;return{missingFromA:e,missingFromB:f,matches:g}},f=function(a,b){for(var c=null,d=0,e;d<a.length;d++){e=a[d];if(b(e)){return e}}return c},g=function(c,d){c=c.slice();d=d.slice();c.sort();d.sort();var e=c.length,f=d.length;if(1>e&&1>f){return!0}if(e!=f){return!1}return c.every(function(a,b){return a==d[b]})},h=function(c,a){var b=Object.keys(c),d=Object.keys(a);if(b.length!=d.length){return!1}return b.every(function(b){var d=c[b],e=a[b],f=_typeof(d),i=_typeof(e);f=null===d?"null":f;i=null===d?"null":i;f="object"===f&&Array.isArray(f)?"array":f;i="object"===i&&Array.isArray(i)?"array":i;if(f!==i){return!1}switch(f){case"object":return h(d,e);case"array":return g(d,e);default:return c[b]==a[b];}})},i=function(c,a){return h({id:c.id,state:c.sendState,text:c.text,timeCreated:c.timeCreated},{id:a.id,state:a.sendState,text:a.text,timeCreated:a.timeCreated})},j=function(a,b,c){return{remove:b,add:c.map(function(b){var c=f(a,function(a){return b.timestamp<a.timestamp});return{before:c,value:b}})}},k=function(a){var b=[],c=[],d=[];a.forEach(function(a){var g=a.a,h=a.b,j=e(g.messages,h.messages,i),k=e(j.missingFromB,j.missingFromA,function(c,a){return c.id==a.id||c.sendState!=a.sendState&&c.timeAdded==a.timeAdded});b=b.concat(k.missingFromB);k.missingFromA.forEach(function(a){var b=null;if(a.timeCreated){b=f(g.messages,function(b){if(a.timeCreated==b.timeCreated){return a.id<b.id}else{return a.timeCreated<b.timeCreated}})}c.push({before:b,value:a,day:g})});d=d.concat(k.matches.map(function(a){return{before:a.a,after:a.b}}))});return{add:c,remove:b,update:d}},l=function(a,b){var c=e(a.messages,b.messages,i);if(c.missingFromA.length||c.missingFromB.length){var f=d(a.messages,a.midnight),g=d(b.messages,b.midnight),h=e(f,g,function(a,b){return a.timestamp==b.timestamp});return{days:j(f,h.missingFromB,h.missingFromA),messages:k(h.matches)}}else{return null}},m=function(a,b){var d=L(a,b),e=B(a,b),f=J(a),g=J(b),h=d&&d.show&&!d.hasMessages,i=d&&!d.show,j=!f&&g;j=j||h||i;j=j||null!==e;if(j){return{type:c.CONVERSATION_TYPES.PRIVATE,showControls:!h&&!e,context:{id:b.id,name:b.name,subname:b.subname,totalmembercount:b.totalMemberCount,imageurl:b.imageUrl,isfavourite:b.isFavourite,ismuted:b.isMuted,showfavourite:null!==b.id,userid:g.id,showonlinestatus:g.showonlinestatus,isonline:g.isonline,isblocked:g.isblocked,iscontact:g.iscontact}}}return null},n=function(a,b){var d=null===a.name&&null!==b.name;if(d){return{type:c.CONVERSATION_TYPES.SELF,showControls:!1,context:{id:b.id,name:b.name,subname:b.subname,imageurl:b.imageUrl,isfavourite:b.isFavourite,showfavourite:null!==b.id,showonlinestatus:!0}}}return null},o=function(a,b){var d=a.totalMemberCount,e=b.totalMemberCount;if(d!=e){return{type:c.CONVERSATION_TYPES.PUBLIC,showControls:!0,context:{id:b.id,name:b.name,subname:b.subname,totalmembercount:b.totalMemberCount,imageurl:b.imageUrl,isfavourite:b.isFavourite,ismuted:b.isMuted,showfavourite:null!==b.id}}}else{return null}},p=function(a,b){var c=a.messages,d=b.messages;if(1>d.length){return null}if(1>c.length){return d[d.length-1].id}var e=c[a.messages.length-1],f=d[d.length-1],g=c[0],h=d[0];if(e.id!=f.id){return f.id}else if(g.id!=h.id){return g.id}return null},q=function(a,b){if(!a.loadingMembers&&b.loadingMembers){return!0}else if(a.loadingMembers&&!b.loadingMembers){return!1}else{return null}},r=function(a,b){if(a.hasTriedToLoadMessages===b.hasTriedToLoadMessages){return null}else if(!b.hasTriedToLoadMessages&&b.loadingMessages){return!0}else if(b.hasTriedToLoadMessages&&!b.loadingMessages){return!1}else{return null}},s=function(a,b){if(!a.loadingMessages&&b.loadingMessages){return!0}else if(a.loadingMessages&&!b.loadingMessages){return!1}else{return null}},t=function(a,b){if(!a.showEmojiPicker&&b.showEmojiPicker){return!0}else if(a.showEmojiPicker&&!b.showEmojiPicker){return!1}else{return null}},u=function(a,b){if(!a.showEmojiAutoComplete&&b.showEmojiAutoComplete){return!0}else if(a.showEmojiAutoComplete&&!b.showEmojiAutoComplete){return!1}else{return null}},v=function(a,b){if(b.pendingBlockUserIds.length){var c=b.pendingBlockUserIds[0];return b.members[c]}else if(a.pendingBlockUserIds.length){return!1}return null},w=function(a,b){if(b.pendingUnblockUserIds.length){var c=b.pendingUnblockUserIds[0];return b.members[c]}else if(a.pendingUnblockUserIds.length){return!1}return null},x=function(a,b){if(b.pendingAddContactIds.length){var c=b.pendingAddContactIds[0];return b.members[c]}else if(a.pendingAddContactIds.length){return!1}return null},y=function(a,b){if(b.pendingRemoveContactIds.length){var c=b.pendingRemoveContactIds[0];return b.members[c]}else if(a.pendingRemoveContactIds.length){return!1}return null},z=function(a,b){var c=a.pendingDeleteMessageIds.length,d=b.pendingDeleteMessageIds.length;if(d&&!c){return{show:!0,type:b.type,canDeleteMessagesForAllUsers:b.canDeleteMessagesForAllUsers}}else if(c&&!d){return{show:!1}}return null},A=function(a,b){if(!a.pendingDeleteConversation&&b.pendingDeleteConversation){return b.type}else if(a.pendingDeleteConversation&&!b.pendingDeleteConversation){return!1}return null},B=function(a,b){var c=a.loggedInUserId,d=J(a),e=J(b),f=!d?[]:d.contactrequests.filter(function(a){return a.requesteduserid==c&&a.userid==d.id}),g=!e?[]:e.contactrequests.filter(function(a){return a.requesteduserid==c&&a.userid==e.id}),h=f.length?f[0]:null,i=g.length?g[0]:null;if(!h&&i){return e}else if(h&&!i){return!1}else{return null}},C=function(a,b){var c=J(a),d=J(b);if(!c&&!d){return null}else if(!c&&d){return d.isblocked?!0:null}else if(!d&&c){return c.isblocked?!1:null}else if(c.isblocked&&!d.isblocked){return!1}else if(!c.isblocked&&d.isblocked){return!0}else{return null}},D=function(a,b){var c=a.isFavourite,d=b.isFavourite;if(null===a.id&&null===b.id){return null}else if(null===a.id&&null!==b.id){return"show-add"}else if(null!==a.id&&null===b.id){return"hide"}else if(c==d){return null}else if(!c&&d){return"show-remove"}else if(c&&!d){return"show-add"}else{return null}},E=function(a,b){var c=a.isMuted,d=b.isMuted;if(null===a.id&&null===b.id){return null}else if(null===a.id&&null!==b.id){return"show-mute"}else if(null!==a.id&&null===b.id){return"hide"}else if(c==d){return null}else if(!c&&d){return"show-unmute"}else if(c&&!d){return"show-mute"}else{return null}},F=function(a,b){var c=a.loggedInUserId,d=J(a),e=J(b),f=!d?[]:d.contactrequests.filter(function(a){return a.userid==c&&a.requesteduserid==d.id||a.userid==d.id&&a.requesteduserid==c}),g=!e?[]:e.contactrequests.filter(function(a){return a.userid==c&&a.requesteduserid==e.id||a.userid==e.id&&a.requesteduserid==c}),h=0<f.length,i=0<g.length;if(!d&&!e){return null}else if(h&&i){return null}else if(!h&&i&&!e.iscontact){return"pending-contact"}else if(!d&&e){return e.iscontact?"contact":null}else if(!e&&d){return d.iscontact?"non-contact":null}else if(d.iscontact&&!e.iscontact){return i?"pending-contact":"non-contact"}else if(!d.iscontact&&e.iscontact){return"contact"}else{return null}},G=function(a,b){if(!a.loadingConfirmAction&&b.loadingConfirmAction){return!0}else if(a.loadingConfirmAction&&!b.loadingConfirmAction){return!1}else{return null}},H=function(a,b){var c=0<a.selectedMessageIds.length,d=0<b.selectedMessageIds.length,e=a.messages.length!=b.messages.length;if(!c&&d){return!0}else if(c&&!d){return!1}else if(c&&e){return!0}else{return null}},I=function(a,b){var c=a.selectedMessageIds,d=b.selectedMessageIds;if(g(c,d)){return null}var f=e(c,d,function(c,a){return c==a});return{count:d.length,add:f.missingFromA,remove:f.missingFromB}},J=function(a){return Object.keys(a.members).reduce(function(b,c){if(c!=a.loggedInUserId&&!b){b=a.members[c]}return b},null)},K=function(a,b){if(b.canmessage){return!1}var c=b.contactrequests.filter(function(b){return b.userid==a||b.requesteduserid}),d=0<c.length;return b.requirescontact&&!b.iscontact&&!d},L=function(a,b){var c=J(a),d=J(b),e=0<a.messages.length,f=0<b.messages.length,g=b.loggedInUserId,h=c&&K(g,c),i=d&&K(g,d),j=x(a,b);if(!a.hasTriedToLoadMessages&&!b.hasTriedToLoadMessages){return null}if(!c&&!d){return null}if(!c&&i){return{show:!0,hasMessages:f,user:d}}if(!1===j&&i){return{show:!0,hasMessages:f,user:d}}if(a.hasTriedToLoadMessages&&b.hasTriedToLoadMessages){if(!h&&i){return{show:!0,hasMessages:f,user:d}}if(h&&!i){return{show:!1,hasMessages:f}}}if(!a.hasTriedToLoadMessages&&b.hasTriedToLoadMessages){if(i){return{show:!0,hasMessages:f,user:d}}}if(a.hasTriedToLoadMessages&&!b.hasTriedToLoadMessages){if(h){return{show:!1,hasMessages:e}}}return null},M=function(a,b){var c=J(a),d=J(b);if(!c&&!d){return null}else if(c&&!d){return c.isblocked?!1:null}else if(!c&&d){return d.isblocked?!0:null}else if(!c.isblocked&&d.isblocked){return!0}else if(c.isblocked&&!d.isblocked){return!1}return null},N=function(a,b){var d=J(a),e=J(b);if(b.type==c.CONVERSATION_TYPES.SELF){return null}if(!d&&!e){return null}else if(d&&!e){return d.canmessage?null:!0}else if(!d&&e){return e.canmessage?null:!0}else if(!d.canmessage&&e.canmessage){return!1}else if(d.canmessage&&!e.canmessage){return!0}return null},O=function(a,b){var c=r(a,b),d=H(a,b),e=L(a,b),f=M(a,b),g=N(a,b),h=null!==e?e.show&&e.hasMessages:null,j=J(b),k=function(a,c){if(a){return c}else if(null!==a&&!a){if(!j){return{type:"content"}}else if(j.isblocked){return{type:"unblock"}}else if(b.messages.length&&K(b.loggedInUserId,j)){return{type:"add-contact",user:j}}else if(!j.canmessage&&j.requirescontact&&!j.iscontact){return{type:"unable-to-message"}}}return null};if(null===c&&null===d&&null===e&&null===f){return null}for(var l=[[c,{type:"placeholder"}],[d,{type:"edit-mode"}],[g,{type:"unable-to-message"}],[f,{type:"unblock"}],[h,{type:"add-contact",user:j}]],m=0;m<l.length;m++){var n=l[m][0],o=l[m][1],p=k(n,o);if(null!==p){return p}}return{type:"content"}},P=function(a,b){var c=r(a,b),d=H(a,b);if(null===c&&null===d){return null}if(c){return{type:"placeholder"}}if(d){return{type:"edit-mode"}}return{type:"content"}},Q=function(a,b){var c=a.type,d=b.type,e=a.id,f=b.id,g=Object.keys(a.members),h=Object.keys(b.members);g.sort();h.sort();var i=g.every(function(a,b){return a==h[b]});if(c!=d){return!0}else if(e&&!f){return!0}else if(e&&f&&e!=f){return!0}else if(!e&&!f&&!i){return!0}return null},R=function(a,b){if(a.type!=b.type){return b.type==c.CONVERSATION_TYPES.SELF}return null},S=function(a,b){var c=b.loggedInUserId,d=J(a),e=J(b),f=!d?[]:d.contactrequests.filter(function(a){return a.userid==c}),g=!e?[]:e.contactrequests.filter(function(a){return a.userid==c}),h=0<f.length,i=0<g.length,j=0<a.messages.length,k=0<a.messages.length;if(!h&&i&&!e.iscontact&&!k){return e.fullname}else if(d&&!d.iscontact&&i&&e.iscontact){return!1}else if(h&&!i){return!1}else if(!j&&k){return!1}else{return null}},T=function(b,d){var e={all:{reset:Q,conversation:l,scrollToMessage:p,loadingMembers:q,loadingFirstMessages:r,loadingMessages:s,confirmDeleteSelectedMessages:z,inEditMode:H,selectedMessages:I,isFavourite:D,isMuted:E,showEmojiPicker:t,showEmojiAutoComplete:u}};e[c.CONVERSATION_TYPES.PRIVATE]={header:m,footer:O,confirmBlockUser:v,confirmUnblockUser:w,confirmAddContact:x,confirmRemoveContact:y,confirmContactRequest:B,confirmDeleteConversation:A,isBlocked:C,isContact:F,loadingConfirmAction:G,requireAddContact:L,contactRequestSent:S};e[c.CONVERSATION_TYPES.PUBLIC]={header:o,footer:P};e[c.CONVERSATION_TYPES.SELF]={header:n,footer:P,confirmDeleteConversation:A,selfConversationMessage:R};var f=a.extend({},e.all);if(d.type&&d.type in e){f=a.extend(f,e[d.type])}return Object.keys(f).reduce(function(a,c){var e=f[c],g=e(b,d);if(null!==g){a[c]=g}return a},{})};return{buildPatch:T}});
//# sourceMappingURL=message_drawer_view_conversation_patcher.min.js.map
